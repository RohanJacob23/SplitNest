import{r as A,j as S}from"./motion-DC4U2J0c.js";import{a8 as C,a9 as me,aa as R,ab as ie,B as ve,c as se,P as Me,X as pe}from"./index-C7VtW-_9.js";function L(r,a){return typeof r=="function"?r(a):r}function k(r,a){return X(a).reduce((e,t)=>{if(e===null)return null;if(typeof e<"u")return e[t]},r)}function $(r,a,i){const e=X(a);function t(s){if(!e.length)return L(i,s);const o=e.shift();if(typeof o=="string"||typeof o=="number"&&!Array.isArray(s))return typeof s=="object"?(s===null&&(s={}),{...s,[o]:t(s[o])}):{[o]:t()};if(Array.isArray(s)&&typeof o=="number"){const n=s.slice(0,o);return[...n.length?n:new Array(o),t(s[o]),...s.slice(o+1)]}return[...new Array(o),t()]}return t(r)}function Fe(r,a){const i=X(a);function e(t){if(!t)return;if(i.length===1){const o=i[0];if(Array.isArray(t)&&typeof o=="number")return t.filter((h,c)=>c!==o);const{[o]:n,...d}=t;return d}const s=i.shift();if(typeof s=="string"&&typeof t=="object")return{...t,[s]:e(t[s])};if(typeof s=="number"&&Array.isArray(t)){if(s>=t.length)return t;const o=t.slice(0,s);return[...o.length?o:new Array(s),e(t[s]),...t.slice(s+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(r)}const ge=/^(\d+)$/gm,be=/\.(\d+)(?=\.)/gm,ye=/^(\d+)\./gm,Se=/\.(\d+$)/gm,Ve=/\.{2,}/gm,Y="__int__",N=`${Y}$1`;function X(r){if(Array.isArray(r))return[...r];if(typeof r!="string")throw new Error("Path must be a string.");return r.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(ge,N).replace(be,`.${N}.`).replace(ye,`${N}.`).replace(Se,`.${N}`).replace(Ve,".").split(".").map(a=>{if(a.startsWith(Y)){const i=a.substring(Y.length),e=parseInt(i,10);return String(e)===i?e:i}return a})}function ae(r,a){return r.length===0?a:a.length===0?r:a.startsWith("[")?r+a:`${r}.${a}`}function Ae(r){return!(Array.isArray(r)&&r.length===0)}function Z(r,a){const{asyncDebounceMs:i}=a,{onChangeAsync:e,onBlurAsync:t,onSubmitAsync:s,onBlurAsyncDebounceMs:o,onChangeAsyncDebounceMs:n}=a.validators||{},d=i??0,h={cause:"change",validate:e,debounceMs:n??d},c={cause:"blur",validate:t,debounceMs:o??d},u={cause:"submit",validate:s,debounceMs:0},l=m=>({...m,debounceMs:0});switch(r){case"submit":return[l(h),l(c),u];case"blur":return[c];case"change":return[h];case"server":default:return[]}}function ee(r,a){const{onChange:i,onBlur:e,onSubmit:t,onMount:s}=a.validators||{},o={cause:"change",validate:i},n={cause:"blur",validate:e},d={cause:"submit",validate:t},h={cause:"mount",validate:s},c={cause:"server",validate:()=>{}};switch(r){case"mount":return[h];case"submit":return[o,n,d,c];case"server":return[c];case"blur":return[n,c];case"change":default:return[o,c]}}const te=r=>!!r&&typeof r=="object"&&"fields"in r;function D(r,a){if(Object.is(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;if(r instanceof Map&&a instanceof Map){if(r.size!==a.size)return!1;for(const[t,s]of r)if(!a.has(t)||!Object.is(s,a.get(t)))return!1;return!0}if(r instanceof Set&&a instanceof Set){if(r.size!==a.size)return!1;for(const t of r)if(!a.has(t))return!1;return!0}const i=Object.keys(r),e=Object.keys(a);if(i.length!==e.length)return!1;for(const t of i)if(!e.includes(t)||!D(r[t],a[t]))return!1;return!0}const oe=({newFormValidatorError:r,isPreviousErrorFromFormValidator:a,previousErrorValue:i})=>r?{newErrorValue:r,newSource:"form"}:a?{newErrorValue:void 0,newSource:void 0}:i?{newErrorValue:i,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},ne=({formLevelError:r,fieldLevelError:a})=>a?{newErrorValue:a,newSource:"field"}:r?{newErrorValue:r,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function we(r){const a=new Map;for(const i of r){const e=[...i.path??[]].map(t=>{const s=typeof t=="object"?t.key:t;return typeof s=="number"?`[${s}]`:s}).join(".").replace(/\.\[/g,"[");a.set(e,(a.get(e)??[]).concat(i))}return Object.fromEntries(a)}const le=r=>{const a=we(r);return{form:a,fields:a}},T={validate({value:r,validationSource:a},i){const e=i["~standard"].validate(r);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return a==="field"?e.issues:le(e.issues)},async validateAsync({value:r,validationSource:a},i){const e=await i["~standard"].validate(r);if(e.issues)return a==="field"?e.issues:le(e.issues)}},de=r=>!!r&&"~standard"in r,H={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function W(r){function a(u,l,m,f){const v=e(u,l,m,f);({insert:()=>n(v,u,l),remove:()=>d(v),swap:()=>f!==void 0&&c(v,u,l,f),move:()=>f!==void 0&&h(v,u,l,f)})[m]()}function i(u,l){return`${u}[${l}]`}function e(u,l,m,f){const v=[i(u,l)];if(m==="swap")v.push(i(u,f));else if(m==="move"){const[p,M]=[Math.min(l,f),Math.max(l,f)];for(let F=p;F<=M;F++)v.push(i(u,F))}else{const p=r.getFieldValue(u),M=Array.isArray(p)?p.length:0;for(let F=l+1;F<M;F++)v.push(i(u,F))}return Object.keys(r.fieldInfo).filter(p=>v.some(M=>p.startsWith(M)))}function t(u,l){return u.replace(/\[(\d+)\]/,(m,f)=>{const v=parseInt(f,10);return`[${l==="up"?v+1:Math.max(0,v-1)}]`})}function s(u,l){(l==="up"?u:[...u].reverse()).forEach(f=>{const v=t(f.toString(),l),p=r.getFieldMeta(v);p?r.setFieldMeta(f,p):r.setFieldMeta(f,o())})}const o=()=>H,n=(u,l,m)=>{s(u,"down"),u.forEach(f=>{f.toString().startsWith(i(l,m))&&r.setFieldMeta(f,o())})},d=u=>{s(u,"up")},h=(u,l,m,f)=>{const v=new Map(Object.keys(r.fieldInfo).filter(p=>p.startsWith(i(l,m))).map(p=>[p,r.getFieldMeta(p)]));s(u,m<f?"up":"down"),Object.keys(r.fieldInfo).filter(p=>p.startsWith(i(l,f))).forEach(p=>{const M=p.replace(i(l,f),i(l,m)),F=v.get(M);F&&r.setFieldMeta(p,F)})},c=(u,l,m,f)=>{u.forEach(v=>{if(!v.toString().startsWith(i(l,m)))return;const p=v.toString().replace(i(l,m),i(l,f)),[M,F]=[r.getFieldMeta(v),r.getFieldMeta(p)];M&&r.setFieldMeta(p,M),F&&r.setFieldMeta(v,F)})};return{handleArrayFieldMetaShift:a}}function Q(r){return{values:r.values??{},errorMap:r.errorMap??{},fieldMetaBase:r.fieldMetaBase??{},isSubmitted:r.isSubmitted??!1,isSubmitting:r.isSubmitting??!1,isValidating:r.isValidating??!1,submissionAttempts:r.submissionAttempts??0,isSubmitSuccessful:r.isSubmitSuccessful??!1,validationMetaMap:r.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class Ee{constructor(a){var i;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var e,t;const s=this.fieldMetaDerived.mount(),o=this.store.mount(),n=()=>{s(),o()};(t=(e=this.options.listeners)==null?void 0:e.onMount)==null||t.call(e,{formApi:this});const{onMount:d}=this.options.validators||{};return d&&this.validateSync("mount"),n},this.update=e=>{var t,s;if(!e)return;const o=this.options;this.options=e;const n=!!((s=(t=e.transform)==null?void 0:t.deps)!=null&&s.some((c,u)=>c!==this.prevTransformArray[u])),d=e.defaultValues&&!D(e.defaultValues,o.defaultValues)&&!this.state.isTouched,h=!D(e.defaultState,o.defaultState)&&!this.state.isTouched;!d&&!h&&!n||C(()=>{this.baseStore.setState(()=>Q(Object.assign({},this.state,h?e.defaultState:{},d?{values:e.defaultValues}:{},n?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,t)=>{const{fieldMeta:s}=this.state,o=this.resetFieldMeta(s);e&&!(t!=null&&t.keepDefaultValues)&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var n;return Q({...this.options.defaultState,values:e??this.options.defaultValues??((n=this.options.defaultState)==null?void 0:n.values),fieldMetaBase:o})})},this.validateAllFields=async e=>{const t=[];return C(()=>{Object.values(this.fieldInfo).forEach(o=>{if(!o.instance)return;const n=o.instance;t.push(Promise.resolve().then(()=>n.validate(e,{skipFormValidation:!0}))),o.instance.state.meta.isTouched||o.instance.setMeta(d=>({...d,isTouched:!0}))})}),(await Promise.all(t)).flat()},this.validateArrayFieldsStartingFrom=async(e,t,s)=>{const o=this.getFieldValue(e),n=Array.isArray(o)?Math.max(o.length-1,0):null,d=[`${e}[${t}]`];for(let l=t+1;l<=(n??0);l++)d.push(`${e}[${l}]`);const h=Object.keys(this.fieldInfo).filter(l=>d.some(m=>l.startsWith(m))),c=[];return C(()=>{h.forEach(l=>{c.push(Promise.resolve().then(()=>this.validateField(l,s)))})}),(await Promise.all(c)).flat()},this.validateField=(e,t)=>{var s;const o=(s=this.fieldInfo[e])==null?void 0:s.instance;return o?(o.state.meta.isTouched||o.setMeta(n=>({...n,isTouched:!0})),o.validate(t)):[]},this.validateSync=e=>{const t=ee(e,this.options);let s=!1;const o={};return C(()=>{var n,d;for(const c of t){if(!c.validate)continue;const u=this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:l,fieldErrors:m}=z(u),f=K(c.cause);for(const v of Object.keys(this.state.fieldMeta)){const p=this.getFieldMeta(v);if(!p)continue;const{errorMap:M,errorSourceMap:F}=p,b=m==null?void 0:m[v],{newErrorValue:V,newSource:w}=oe({newFormValidatorError:b,isPreviousErrorFromFormValidator:(F==null?void 0:F[f])==="form",previousErrorValue:M==null?void 0:M[f]});w==="form"&&(o[v]={...o[v],[f]:b}),(M==null?void 0:M[f])!==V&&this.setFieldMeta(v,E=>({...E,errorMap:{...E.errorMap,[f]:V},errorSourceMap:{...E.errorSourceMap,[f]:w}}))}((n=this.state.errorMap)==null?void 0:n[f])!==l&&this.baseStore.setState(v=>({...v,errorMap:{...v.errorMap,[f]:l}})),(l||m)&&(s=!0)}const h=K("submit");(d=this.state.errorMap)!=null&&d[h]&&e!=="submit"&&!s&&this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[h]:void 0}}))}),{hasErrored:s,fieldsErrorMap:o}},this.validateAsync=async e=>{const t=Z(e,this.options);this.state.isFormValidating||this.baseStore.setState(h=>({...h,isFormValidating:!0}));const s=[];let o;for(const h of t){if(!h.validate)continue;const c=K(h.cause),u=this.state.validationMetaMap[c];u==null||u.lastAbortController.abort();const l=new AbortController;this.state.validationMetaMap[c]={lastAbortController:l},s.push(new Promise(async m=>{let f;try{f=await new Promise((F,b)=>{setTimeout(async()=>{if(l.signal.aborted)return F(void 0);try{F(await this.runValidator({validate:h.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:l.signal},type:"validateAsync"}))}catch(V){b(V)}},h.debounceMs)})}catch(F){f=F}const{formError:v,fieldErrors:p}=z(f);p&&(o=o?{...o,...p}:p);const M=K(h.cause);for(const F of Object.keys(this.state.fieldMeta)){const b=this.getFieldMeta(F);if(!b)continue;const{errorMap:V,errorSourceMap:w}=b,E=o==null?void 0:o[F],{newErrorValue:_,newSource:O}=oe({newFormValidatorError:E,isPreviousErrorFromFormValidator:(w==null?void 0:w[M])==="form",previousErrorValue:V==null?void 0:V[M]});(V==null?void 0:V[M])!==_&&this.setFieldMeta(F,y=>({...y,errorMap:{...y.errorMap,[M]:_},errorSourceMap:{...y.errorSourceMap,[M]:O}}))}this.baseStore.setState(F=>({...F,errorMap:{...F.errorMap,[M]:v}})),m(o?{fieldErrors:o,errorMapKey:M}:void 0)}))}let n=[];const d={};if(s.length){n=await Promise.all(s);for(const h of n)if(h!=null&&h.fieldErrors){const{errorMapKey:c}=h;for(const[u,l]of Object.entries(h.fieldErrors)){const f={...d[u]||{},[c]:l};d[u]=f}}}return this.baseStore.setState(h=>({...h,isFormValidating:!1})),d},this.validate=e=>{const{hasErrored:t,fieldsErrorMap:s}=this.validateSync(e);return t&&!this.options.asyncAlways?s:this.validateAsync(e)},this.getFieldValue=e=>k(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var t;return(t=this.fieldInfo)[e]||(t[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,t)=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[e]:L(t,s.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((t,s)=>{const o=s;return t[o]=H,t},{}),this.setFieldValue=(e,t,s)=>{const o=(s==null?void 0:s.dontUpdateMeta)??!1;C(()=>{o||this.setFieldMeta(e,n=>({...n,isTouched:!0,isDirty:!0,errorMap:{...n==null?void 0:n.errorMap,onMount:void 0}})),this.baseStore.setState(n=>({...n,values:$(n.values,e,t)}))})},this.deleteField=e=>{const s=[...Object.keys(this.fieldInfo).filter(o=>{const n=e.toString();return o!==n&&o.startsWith(n)}),e];this.baseStore.setState(o=>{const n={...o};return s.forEach(d=>{n.values=Fe(n.values,d),delete this.fieldInfo[d],delete n.fieldMetaBase[d]}),n})},this.pushFieldValue=(e,t,s)=>{this.setFieldValue(e,o=>[...Array.isArray(o)?o:[],t],s),this.validateField(e,"change")},this.insertFieldValue=async(e,t,s,o)=>{this.setFieldValue(e,n=>[...n.slice(0,t),s,...n.slice(t)],o),await this.validateField(e,"change"),W(this).handleArrayFieldMetaShift(e,t,"insert"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.replaceFieldValue=async(e,t,s,o)=>{this.setFieldValue(e,n=>n.map((d,h)=>h===t?s:d),o),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.removeFieldValue=async(e,t,s)=>{const o=this.getFieldValue(e),n=Array.isArray(o)?Math.max(o.length-1,0):null;if(this.setFieldValue(e,d=>d.filter((h,c)=>c!==t),s),W(this).handleArrayFieldMetaShift(e,t,"remove"),n!==null){const d=`${e}[${n}]`;this.deleteField(d)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.swapFieldValues=(e,t,s,o)=>{this.setFieldValue(e,n=>{const d=n[t],h=n[s];return $($(n,`${t}`,h),`${s}`,d)},o),W(this).handleArrayFieldMetaShift(e,t,"swap",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.moveFieldValues=(e,t,s,o)=>{this.setFieldValue(e,n=>{const d=[...n];return d.splice(s,0,d.splice(t,1)[0]),d},o),W(this).handleArrayFieldMetaShift(e,t,"move",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.clearFieldValues=(e,t)=>{const s=this.getFieldValue(e),o=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(e,[],t),o!==null)for(let n=0;n<=o;n++){const d=`${e}[${n}]`;this.deleteField(d)}this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(t=>({...t,fieldMetaBase:{...t.fieldMetaBase,[e]:H},values:this.options.defaultValues?$(t.values,e,k(this.options.defaultValues,e)):t.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[t,s])=>(Object.keys(s).length&&s.errors.length&&(e[t]={errors:s.errors,errorMap:s.errorMap}),e),{})}),this.parseValuesWithSchema=e=>T.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>T.validateAsync({value:this.state.values,validationSource:"form"},e),this.baseStore=new me(Q({...a==null?void 0:a.defaultState,values:(a==null?void 0:a.defaultValues)??((i=a==null?void 0:a.defaultState)==null?void 0:i.values)})),this.fieldMetaDerived=new R({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{var o,n,d;const h=s,c=e==null?void 0:e[0],u=t[0];let l=0;const m={};for(const f of Object.keys(u.fieldMetaBase)){const v=u.fieldMetaBase[f],p=c==null?void 0:c.fieldMetaBase[f],M=h==null?void 0:h[f],F=k(u.values,f);let b=M==null?void 0:M.errors;if(!p||v.errorMap!==p.errorMap){b=Object.values(v.errorMap??{}).filter(O=>O!==void 0);const _=(o=this.getFieldInfo(f))==null?void 0:o.instance;_&&!_.options.disableErrorFlat&&(b=b==null?void 0:b.flat(1))}const V=!Ae(b??[]),w=!v.isDirty,E=D(F,k(this.options.defaultValues,f))||D(F,(d=(n=this.getFieldInfo(f))==null?void 0:n.instance)==null?void 0:d.options.defaultValue);if(M&&M.isPristine===w&&M.isValid===V&&M.isDefaultValue===E&&M.errors===b&&v===p){m[f]=M,l++;continue}m[f]={...v,errors:b,isPristine:w,isValid:V,isDefaultValue:E}}return Object.keys(u.fieldMetaBase).length&&h&&l===Object.keys(u.fieldMetaBase).length?h:m}}),this.store=new R({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{var o,n,d,h;const c=s,u=e==null?void 0:e[0],l=t[0],m=t[1],f=Object.values(m).filter(Boolean),v=f.some(g=>g.isValidating),p=f.every(g=>g.isValid),M=f.some(g=>g.isTouched),F=f.some(g=>g.isBlurred),b=f.every(g=>g.isDefaultValue),V=M&&((o=l.errorMap)==null?void 0:o.onMount),w=f.some(g=>g.isDirty),E=!w,_=!!((n=l.errorMap)!=null&&n.onMount||f.some(g=>{var I;return(I=g==null?void 0:g.errorMap)==null?void 0:I.onMount})),O=!!v;let y=(c==null?void 0:c.errors)??[];(!u||l.errorMap!==u.errorMap)&&(y=Object.values(l.errorMap).reduce((g,I)=>I===void 0?g:I&&te(I)?(g.push(I.form),g):(g.push(I),g),[]));const B=y.length===0,j=p&&B,fe=this.options.canSubmitWhenInvalid??!1,re=l.submissionAttempts===0&&!M&&!_||!O&&!l.isSubmitting&&j||fe;let P=l.errorMap;if(V&&(y=y.filter(g=>g!==l.errorMap.onMount),P=Object.assign(P,{onMount:void 0})),c&&u&&c.errorMap===P&&c.fieldMeta===this.fieldMetaDerived.state&&c.errors===y&&c.isFieldsValidating===v&&c.isFieldsValid===p&&c.isFormValid===B&&c.isValid===j&&c.canSubmit===re&&c.isTouched===M&&c.isBlurred===F&&c.isPristine===E&&c.isDefaultValue===b&&c.isDirty===w&&D(u,l))return c;let q={...l,errorMap:P,fieldMeta:this.fieldMetaDerived.state,errors:y,isFieldsValidating:v,isFieldsValid:p,isFormValid:B,isValid:j,canSubmit:re,isTouched:M,isBlurred:F,isPristine:E,isDefaultValue:b,isDirty:w};const J=((d=this.options.transform)==null?void 0:d.deps)??[];if(J.length!==this.prevTransformArray.length||J.some((g,I)=>g!==this.prevTransformArray[I])){const g=Object.assign({},this,{state:q});(h=this.options.transform)==null||h.fn(g),q=g.state,this.prevTransformArray=J}return q}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(a||{})}get state(){return this.store.state}runValidator(a){return de(a.validate)?T[a.type](a.value,a.validate):a.validate(a.value)}async handleSubmit(a){var i,e,t,s,o,n,d,h;if(this.baseStore.setState(u=>({...u,isSubmitted:!1,submissionAttempts:u.submissionAttempts+1,isSubmitSuccessful:!1})),C(()=>{Object.values(this.fieldInfo).forEach(u=>{u.instance&&(u.instance.state.meta.isTouched||u.instance.setMeta(l=>({...l,isTouched:!0})))})}),!this.state.canSubmit)return;this.baseStore.setState(u=>({...u,isSubmitting:!0}));const c=()=>{this.baseStore.setState(u=>({...u,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){c(),(e=(i=this.options).onSubmitInvalid)==null||e.call(i,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){c(),(s=(t=this.options).onSubmitInvalid)==null||s.call(t,{value:this.state.values,formApi:this});return}C(()=>{Object.values(this.fieldInfo).forEach(u=>{var l,m,f;(f=(m=(l=u.instance)==null?void 0:l.options.listeners)==null?void 0:m.onSubmit)==null||f.call(m,{value:u.instance.state.value,fieldApi:u.instance})})}),(n=(o=this.options.listeners)==null?void 0:o.onSubmit)==null||n.call(o,{formApi:this});try{await((h=(d=this.options).onSubmit)==null?void 0:h.call(d,{value:this.state.values,formApi:this,meta:a??this.options.onSubmitMeta})),C(()=>{this.baseStore.setState(u=>({...u,isSubmitted:!0,isSubmitSuccessful:!0})),c()})}catch(u){throw this.baseStore.setState(l=>({...l,isSubmitSuccessful:!1})),c(),u}}setErrorMap(a){C(()=>{Object.entries(a).forEach(([i,e])=>{const t=i;if(te(e)){const{formError:s,fieldErrors:o}=z(e);for(const n of Object.keys(this.fieldInfo))this.getFieldMeta(n)&&this.setFieldMeta(n,h=>({...h,errorMap:{...h.errorMap,[t]:o==null?void 0:o[n]},errorSourceMap:{...h.errorSourceMap,[t]:"form"}}));this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,[t]:s}}))}else this.baseStore.setState(s=>({...s,errorMap:{...s.errorMap,[t]:e}}))})})}}function z(r){if(r){if(te(r)){const a=z(r.form).formError,i=r.fields;return{formError:a,fieldErrors:i}}return{formError:r}}return{formError:void 0}}function K(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class _e{constructor(a){this.options={},this.mount=()=>{var i,e;const t=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const s=this.getInfo();s.instance=this,this.update(this.options);const{onMount:o}=this.options.validators||{};if(o){const n=this.runValidator({validate:o,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});n&&this.setMeta(d=>({...d,errorMap:{...d==null?void 0:d.errorMap,onMount:n},errorSourceMap:{...d==null?void 0:d.errorSourceMap,onMount:"field"}}))}return(e=(i=this.options.listeners)==null?void 0:i.onMount)==null||e.call(i,{value:this.state.value,fieldApi:this}),t},this.update=i=>{this.options=i;const e=this.name!==i.name;if(this.name=i.name,this.state.value===void 0){const t=k(i.form.options.defaultValues,i.name),s=i.defaultValue??t;e?this.setValue(o=>o||s,{dontUpdateMeta:!0}):s!==void 0&&this.setValue(s,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(i,e)=>{this.form.setFieldValue(this.name,i,e),this.triggerOnChangeListener(),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=i=>this.form.setFieldMeta(this.name,i),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(i,e)=>{this.form.pushFieldValue(this.name,i,e),this.triggerOnChangeListener()},this.insertValue=(i,e,t)=>{this.form.insertFieldValue(this.name,i,e,t),this.triggerOnChangeListener()},this.replaceValue=(i,e,t)=>{this.form.replaceFieldValue(this.name,i,e,t),this.triggerOnChangeListener()},this.removeValue=(i,e)=>{this.form.removeFieldValue(this.name,i,e),this.triggerOnChangeListener()},this.swapValues=(i,e,t)=>{this.form.swapFieldValues(this.name,i,e,t),this.triggerOnChangeListener()},this.moveValue=(i,e,t)=>{this.form.moveFieldValues(this.name,i,e,t),this.triggerOnChangeListener()},this.clearValues=i=>{this.form.clearFieldValues(this.name,i),this.triggerOnChangeListener()},this.getLinkedFields=i=>{const e=Object.values(this.form.fieldInfo),t=[];for(const s of e){if(!s.instance)continue;const{onChangeListenTo:o,onBlurListenTo:n}=s.instance.options.validators||{};i==="change"&&(o!=null&&o.includes(this.name))&&t.push(s.instance),i==="blur"&&(n!=null&&n.includes(this.name))&&t.push(s.instance)}return t},this.validateSync=(i,e)=>{var t;const s=ee(i,this.options),n=this.getLinkedFields(i).reduce((c,u)=>{const l=ee(i,u.options);return l.forEach(m=>{m.field=u}),c.concat(l)},[]);let d=!1;C(()=>{const c=(u,l)=>{var m;const f=U(l.cause),v=l.validate?ue(u.runValidator({validate:l.validate,value:{value:u.store.state.value,validationSource:"field",fieldApi:u},type:"validate"})):void 0,p=e[f],{newErrorValue:M,newSource:F}=ne({formLevelError:p,fieldLevelError:v});((m=u.state.meta.errorMap)==null?void 0:m[f])!==M&&u.setMeta(b=>({...b,errorMap:{...b.errorMap,[f]:M},errorSourceMap:{...b.errorSourceMap,[f]:F}})),M&&(d=!0)};for(const u of s)c(this,u);for(const u of n)u.validate&&c(u.field,u)});const h=U("submit");return(t=this.state.meta.errorMap)!=null&&t[h]&&i!=="submit"&&!d&&this.setMeta(c=>({...c,errorMap:{...c.errorMap,[h]:void 0},errorSourceMap:{...c.errorSourceMap,[h]:void 0}})),{hasErrored:d}},this.validateAsync=async(i,e)=>{const t=Z(i,this.options),s=await e,o=this.getLinkedFields(i),n=o.reduce((l,m)=>{const f=Z(i,m.options);return f.forEach(v=>{v.field=m}),l.concat(f)},[]);this.state.meta.isValidating||this.setMeta(l=>({...l,isValidating:!0}));for(const l of o)l.setMeta(m=>({...m,isValidating:!0}));const d=[],h=[],c=(l,m,f)=>{const v=U(m.cause),p=l.getInfo().validationMetaMap[v];p==null||p.lastAbortController.abort();const M=new AbortController;this.getInfo().validationMetaMap[v]={lastAbortController:M},f.push(new Promise(async F=>{var b;let V;try{V=await new Promise((y,B)=>{this.timeoutIds.validations[m.cause]&&clearTimeout(this.timeoutIds.validations[m.cause]),this.timeoutIds.validations[m.cause]=setTimeout(async()=>{if(M.signal.aborted)return y(void 0);try{y(await this.runValidator({validate:m.validate,value:{value:l.store.state.value,fieldApi:l,signal:M.signal,validationSource:"field"},type:"validateAsync"}))}catch(j){B(j)}},m.debounceMs)})}catch(y){V=y}if(M.signal.aborted)return F(void 0);const w=ue(V),E=(b=s[this.name])==null?void 0:b[v],{newErrorValue:_,newSource:O}=ne({formLevelError:E,fieldLevelError:w});l.setMeta(y=>({...y,errorMap:{...y==null?void 0:y.errorMap,[v]:_},errorSourceMap:{...y.errorSourceMap,[v]:O}})),F(_)}))};for(const l of t)l.validate&&c(this,l,d);for(const l of n)l.validate&&c(l.field,l,h);let u=[];(d.length||h.length)&&(u=await Promise.all(d),await Promise.all(h)),this.setMeta(l=>({...l,isValidating:!1}));for(const l of o)l.setMeta(m=>({...m,isValidating:!1}));return u.filter(Boolean)},this.validate=(i,e)=>{var t;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=e!=null&&e.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(i),{hasErrored:o}=this.validateSync(i,s[this.name]??{});if(o&&!this.options.asyncAlways)return(t=this.getInfo().validationMetaMap[U(i)])==null||t.lastAbortController.abort(),this.state.meta.errors;const n=e!=null&&e.skipFormValidation?Promise.resolve({}):this.form.validateAsync(i);return this.validateAsync(i,n)},this.handleChange=i=>{this.setValue(i)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(e=>({...e,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(e=>({...e,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=i=>T.validate({value:this.state.value,validationSource:"field"},i),this.parseValueWithSchemaAsync=i=>T.validateAsync({value:this.state.value,validationSource:"field"},i),this.form=a.form,this.name=a.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new R({deps:[this.form.store],fn:()=>{const i=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{...H,...a.defaultMeta};return{value:i,meta:e}}}),this.options=a}get state(){return this.store.state}runValidator(a){return de(a.validate)?T[a.type](a.value,a.validate):a.validate(a.value)}setErrorMap(a){this.setMeta(i=>({...i,errorMap:{...i.errorMap,...a}}))}triggerOnBlurListener(){var a,i,e,t,s,o;const n=(a=this.form.options.listeners)==null?void 0:a.onBlurDebounceMs;n&&n>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var h,c;(c=(h=this.form.options.listeners)==null?void 0:h.onBlur)==null||c.call(h,{formApi:this.form,fieldApi:this})},n)):(e=(i=this.form.options.listeners)==null?void 0:i.onBlur)==null||e.call(i,{formApi:this.form,fieldApi:this});const d=(t=this.options.listeners)==null?void 0:t.onBlurDebounceMs;d&&d>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var h,c;(c=(h=this.options.listeners)==null?void 0:h.onBlur)==null||c.call(h,{value:this.state.value,fieldApi:this})},d)):(o=(s=this.options.listeners)==null?void 0:s.onBlur)==null||o.call(s,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var a,i,e,t,s,o;const n=(a=this.form.options.listeners)==null?void 0:a.onChangeDebounceMs;n&&n>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{var h,c;(c=(h=this.form.options.listeners)==null?void 0:h.onChange)==null||c.call(h,{formApi:this.form,fieldApi:this})},n)):(e=(i=this.form.options.listeners)==null?void 0:i.onChange)==null||e.call(i,{formApi:this.form,fieldApi:this});const d=(t=this.options.listeners)==null?void 0:t.onChangeDebounceMs;d&&d>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var h,c;(c=(h=this.options.listeners)==null?void 0:h.onChange)==null||c.call(h,{value:this.state.value,fieldApi:this})},d)):(o=(s=this.options.listeners)==null?void 0:s.onChange)==null||o.call(s,{value:this.state.value,fieldApi:this})}}function ue(r){if(r)return r}function U(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class G{constructor(a){if(this.getFormFieldName=i=>{if(typeof this.fieldsMap=="string")return ae(this.fieldsMap,i);const e=X(i)[0];if(typeof e!="string")return"";const t=i.slice(e.length),s=this.fieldsMap[e];return ae(s,t)},this.mount=()=>this.store.mount(),this.validateArrayFieldsStartingFrom=async(i,e,t)=>this.form.validateArrayFieldsStartingFrom(this.getFormFieldName(i),e,t),this.validateField=(i,e)=>this.form.validateField(this.getFormFieldName(i),e),this.getFieldValue=i=>this.form.getFieldValue(this.getFormFieldName(i)),this.getFieldMeta=i=>this.form.getFieldMeta(this.getFormFieldName(i)),this.setFieldMeta=(i,e)=>this.form.setFieldMeta(this.getFormFieldName(i),e),this.setFieldValue=(i,e,t)=>this.form.setFieldValue(this.getFormFieldName(i),e,t),this.deleteField=i=>this.form.deleteField(this.getFormFieldName(i)),this.pushFieldValue=(i,e,t)=>this.form.pushFieldValue(this.getFormFieldName(i),e,t),this.insertFieldValue=async(i,e,t,s)=>this.form.insertFieldValue(this.getFormFieldName(i),e,t,s),this.replaceFieldValue=async(i,e,t,s)=>this.form.replaceFieldValue(this.getFormFieldName(i),e,t,s),this.removeFieldValue=async(i,e,t)=>this.form.removeFieldValue(this.getFormFieldName(i),e,t),this.swapFieldValues=(i,e,t,s)=>this.form.swapFieldValues(this.getFormFieldName(i),e,t,s),this.moveFieldValues=(i,e,t,s)=>this.form.moveFieldValues(this.getFormFieldName(i),e,t,s),this.clearFieldValues=(i,e)=>this.form.clearFieldValues(this.getFormFieldName(i),e),this.resetField=i=>this.form.resetField(this.getFormFieldName(i)),this.validateAllFields=i=>this.form.validateAllFields(i),a.form instanceof G){const i=a.form;if(this.form=i.form,typeof a.fields=="string")this.fieldsMap=i.getFormFieldName(a.fields);else{const e={...a.fields};for(const t in e)e[t]=i.getFormFieldName(e[t]);this.fieldsMap=e}}else this.form=a.form,this.fieldsMap=a.fields;this.store=new R({deps:[this.form.store],fn:({currDepVals:i})=>{const e=i[0];let t;if(typeof this.fieldsMap=="string")t=k(e.values,this.fieldsMap);else{t={};const s=this.fieldsMap;for(const o in s)t[o]=k(e.values,s[o])}return{values:t}}})}get state(){return this.store.state}async handleSubmit(a){return this.form.handleSubmit(a)}}const x=typeof window<"u"?A.useLayoutEffect:A.useEffect;function Ie(r){const[a]=A.useState(()=>{const e=new _e({...r,form:r.form,name:r.name});return e.Field=ce,e});return x(a.mount,[a]),x(()=>{a.update(r)}),ie(a.store,r.mode==="array"?i=>[i.meta,Object.keys(i.value??[]).length]:void 0),a}const ce=({children:r,...a})=>{const i=Ie(a),e=A.useMemo(()=>L(r,i),[r,i,i.state.value,i.state.meta]);return S.jsx(S.Fragment,{children:e})};function Ce({form:r,selector:a,children:i}){const e=ie(r.store,a);return L(i,e)}function Oe(r){const[a]=A.useState(()=>{const i=new Ee(r),e=i;return e.Field=function(s){return S.jsx(ce,{...s,form:i})},e.Subscribe=function(s){return S.jsx(Ce,{form:i,selector:s.selector,children:s.children})},e});return x(a.mount,[]),x(()=>{a.update(r)}),a}function ke({lens:r,selector:a,children:i}){const e=ie(r.store,a);return L(i,e)}function De(r){const[a]=A.useState(()=>{const i=new G(r),e=r.form instanceof G?r.form.form:r.form,t=i;return t.AppForm=function(o){return S.jsx(e.AppForm,{...o})},t.AppField=function({name:o,...n}){return S.jsx(e.AppField,{name:a.getFormFieldName(o),...n})},t.Field=function({name:o,...n}){return S.jsx(e.Field,{name:a.getFormFieldName(o),...n})},t.Subscribe=function(o){return S.jsx(ke,{lens:a,selector:o.selector,children:o.children})},Object.assign(t,{...r.formComponents})});return x(a.mount,[a]),a}function Te(){const r=A.createContext(null);function a(){const t=A.useContext(r);if(!t)throw new Error("`fieldContext` only works when within a `fieldComponent` passed to `createFormHook`");return t}const i=A.createContext(null);function e(){const t=A.useContext(i);if(!t)throw new Error("`formContext` only works when within a `formComponent` passed to `createFormHook`");return t}return{fieldContext:r,useFieldContext:a,useFormContext:e,formContext:i}}function Be({fieldComponents:r,fieldContext:a,formContext:i,formComponents:e}){function t(n){const d=Oe(n),h=A.useMemo(()=>({children:m})=>S.jsx(i.Provider,{value:d,children:m}),[d]),c=A.useMemo(()=>({children:m,...f})=>S.jsx(d.Field,{...f,children:v=>S.jsx(a.Provider,{value:v,children:m(Object.assign(v,r))})}),[d]);return A.useMemo(()=>Object.assign(d,{AppField:c,AppForm:h,...e}),[d,c,h])}function s({render:n,props:d}){return h=>n({...d,...h})}function o({render:n,props:d,defaultValues:h}){return function(u){const l=A.useMemo(()=>({form:u.form,fields:u.fields,defaultValues:h,formComponents:e}),[u.form,u.fields]),m=De(l);return n({...d,...u,group:m})}}return{useAppForm:t,withForm:s,withFieldGroup:o}}const{fieldContext:je,useFieldContext:xe,formContext:Le,useFormContext:Pe}=Te();function $e({label:r,className:a,isLoading:i}){const e=Pe();return S.jsx(e.Subscribe,{selector:t=>[t.isSubmitting,t.isValid],children:([t,s])=>S.jsx(ve,{type:"submit",animate:{x:s?void 0:[null,-5,0,5,0]},transition:{x:{duration:.2}},disabled:t,isLoading:t||i,className:se("overflow-y-clip",a),children:r})})}var Ne="Label",he=A.forwardRef((r,a)=>S.jsx(Me.label,{...r,ref:a,onMouseDown:i=>{var t;i.target.closest("button, input, select, textarea")||((t=r.onMouseDown)==null||t.call(r,i),!i.defaultPrevented&&i.detail>1&&i.preventDefault())}}));he.displayName=Ne;var We=he;function Ke({className:r,...a}){return S.jsx(We,{"data-slot":"label",className:se("flex select-none items-center gap-2 font-medium text-sm leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50 group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50",r),...a})}function Ue({label:r,className:a,...i}){const e=xe();return S.jsxs("div",{className:"*:not-first:mt-2",children:[S.jsx(Ke,{htmlFor:r,children:r}),S.jsx(pe,{id:r,value:e.state.value,"aria-invalid":!e.state.meta.isValid,onChange:t=>e.handleChange(t.target.value),onBlur:e.handleBlur,className:se("peer",a),...i}),!e.state.meta.isValid&&e.state.meta.errors.map((t,s)=>S.jsx("span",{className:"mt-2 text-xs peer-aria-invalid:text-destructive",children:t.message},s))]})}const{useAppForm:Ge}=Be({fieldContext:je,formContext:Le,fieldComponents:{TextField:Ue},formComponents:{SubmitButton:$e}});export{Ke as L,Ge as u};
